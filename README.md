# kaggle_American_Express
- Title American Express - Default Prediction
URL	  https://www.kaggle.com/competitions/amex-default-prediction
Timeline	2022/5/25 ⇒ 2022/8/24

- Description
カード発行会社は、私たちが請求した金額をきちんと返済してくれることをどうやって確認するのでしょうか？
貸し倒れ予測は、消費者金融ビジネスのリスク管理の中心的存在です。
貸し倒れを予測することで、貸し出しの決定を最適化し、より良い顧客体験と健全なビジネス経済を実現することができます。

- Evaluation
このコンペティションの評価指標である , Mは、順位付けのための2つの指標の平均値である。
正規化ジニ係数（Normalized Gini Coefficient) ,G および4%時点のデフォルト率（default rate captured at 4%,D.
4%で捕捉されるデフォルト率は，予測値の最高位である4%以内に捕捉された正のラベル（デフォルト）の割合であり，感度/想起統計量を表している．
サブメトリクスのG,Dの両方と 、ネガティブラベルには、ダウンサンプリングを調整するために20の重みが与えられます。

- Data
このコンペティションの目的は、毎月の顧客プロファイルに基づいて、ある顧客が将来クレジットカードの残高を返さない確率を予測することです。
対象の二項変数は、最新のクレジットカード明細書から18ヶ月間のパフォーマンスウィンドウを観察することによって計算され、
もし顧客が最新の明細書の日付から120日以内に返済額を支払わない場合は、デフォルトイベントとみなされます。
データセットには、各顧客の各明細書日付における集約されたプロファイル特徴が含まれています。特徴は匿名化、正規化されており、以下の一般的なカテゴリに分類されます。
	
D_* = 延滞変数　　96カラム  
S_* = 支出変数　　22カラム
P_* = 支払い変数　 3カラム	P_2,P_3,P_4
B_* = 残高変数　　40カラム
R_* = リスク変数　28カラム (合計189カラム)
であり、以下の特徴はカテゴリ的である。  
	
[B_30', 'B_38', 'd_114', 'd_116', 'd_117', 'd_120', 'd_126', 'd_63', 'd_64', 'd_66', 'd_68'].
あなたのタスクは、各顧客IDについて、将来の支払い不履行の確率を予測することです（ターゲット=1）。
このデータセットでは、ネガティブ・クラスは5%でサブサンプルされているので、スコアリング・メトリックでは20倍の重み付けを受けることに注意してください。

### 特徴量の特徴
全191カラム
| dtype_name | counts | samples |
| --- | --- | --- |
| int8 | 2 |B_31, target|
| float16 | 185 | --- |
| object | 4 |customer_ID, S_2(日付),D_63,D_64 |

<int8>  
B_31 0/1 ほとんど1が立っている。平均0.99  
  
<object>  
S_2	日付列
D_63	CL,CO,CR,XL,XM,XZ
D_64	-1,O,R,U

欠損が多い  
D_87 D_88 D_108	D_110 D_111 B_39 D_73 B_42 D_134 D_137 D_138 D_135 D_136 R_9 B_29 D_106 D_132 D_49 R_26 D_76  

カテゴリ的  
B_30, B_38, d_114, d_116, d_117, d_120, d_126, d_63, d_64, d_66, d_68  

### idea_list
・曜日によってデータが異なる⇒週末支払傾向のある人は返しにくいなど  
・特徴量重要度の確認⇒その内容を確認してみる  
・主成分分析の効果がありそうか検討  
・customer_ID別に最終明細書時点のデータのみ参考にしているので、それ以前のデータを使う方法を検討する  
・累計明細書数、各数値の初回からの増減率、平均値、最頻値など



### log_date
| 日付| 説明|
| ---------------------------------- | ----------------------------------------------- |
|2022-06-09|データ量が多くて主成分分析が回っていない<br>読む⇒https://www.kaggle.com/code/aliphya/who-would-default-next|
|2022-06-10|コードを日本語に訳しつつ1行ずつ実行して内容理解を進めた。<br>EDAは概ねOK！明日からはモデリングの確認|
|2022-06-11|久しぶりにlightgbmの実装。メモリエラー対策を進めた。<br>ひとまずスコアは出た。明日からは特徴量の精査|
|2022-06-12|とりあえず特徴量の詳細確認と特徴量重要度の算出をした。<br>明日は新特徴量を追加してみる|
|2022-06-13|特徴量を追加したがメモリ不足でエラーが発生。対策を検討する。<br>多変量解析か？|
|2022-06-14|mergeよりjoinに変更し処理軽量化を図る。GPUオフだとモデル落ちない。<br>モデルのinput179とtest189の特徴量が異なるというエラー|
|2022-06-15|欠損値があまりにも多いカラムは削除し、一部欠損しているデータは0で埋めた<br>主成分分析の必要コードを実装し、データ量削減した|
|2022-06-17|数値カラムのみを使って主成分分析を実施した後、カテゴリ変数やTargetを再び戻す処理を追加。<br>コードに関しても見やすいよう一部書き換え。処理落ち減ったように感じる|
|2022-06-18|エンコーディングを実装<br>主成分の個数指定もできた。joinへの書き換えも進めた|
	

### 参考にした記事一覧
LightGBMのパラメータチューニングまとめ  
https://qiita.com/c60evaporator/items/351188110f328ff921b9  
【初心者向け】特徴量重要度の算出 (LightGBM) 【Python】【機械学習】  
https://mathmatical22.xyz/2020/04/12/%e3%80%90%e5%88%9d%e5%bf%83%e8%80%85%e5%90%91%e3%81%91%e3%80%91%e7%89%b9%e5%be%b4%e9%87%8f%e9%87%8d%e8%a6%81%e5%ba%a6%e3%81%ae%e7%ae%97%e5%87%ba-lightgbm-%e3%80%90python%e3%80%91%e3%80%90%e6%a9%9f/  
light GBMでimportanceを出す  
https://qiita.com/studio_haneya/items/e70e835c26524d506e19  
【Python】Kaggleで引っ張りだこ！lightgbmの２種類の使い方！Training APIとScikit-learn API！【lightgbm】  
https://shiokoji11235.com/two_interface_of_lightgbm  
【Python】Pandasのメモリ使用量の削減方法のまとめ  
https://www.st-hakky-blog.com/entry/2020/06/10/093016  
めっちゃ使えるpandasのメモリサイズをグッと抑える汎用的な関数  
https://qiita.com/hiroyuki_kageyama/items/02865616811022f79754  



